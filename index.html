<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Slot hra ‚Äì 3 v√°lce</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#111b2e;
      --card:#0f1729;
      --text:#e7eefc;
      --muted:#9fb2d6;
      --accent:#4ea1ff;
      --good:#3ddc97;
      --bad:#ff5c7a;
      --border:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 30% 10%, #14234a 0%, var(--bg) 55%);
      color:var(--text);
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{
      width:min(860px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header{
      padding:18px 18px 12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      background: rgba(0,0,0,.12);
      border-bottom:1px solid var(--border);
    }
    header h1{
      font-size:16px;
      margin:0;
      font-weight:700;
      letter-spacing:.2px;
    }
    header .sub{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
    }
    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      background: rgba(0,0,0,.18);
      border:1px solid var(--border);
      border-radius: 999px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .pill b{color:var(--text); font-weight:700}
    main{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      padding:16px;
    }
    @media (max-width: 820px){
      main{grid-template-columns: 1fr; }
    }

    .machine{
      background: rgba(0,0,0,.14);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:16px;
    }

    .reels{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
      margin-bottom:14px;
    }
    .reel{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius: 14px;
      height:140px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .symbol{
      font-size:64px;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.35));
      transform: translateZ(0);
    }
    .shine{
      position:absolute;
      inset:-40% -30%;
      background: linear-gradient(120deg, transparent 30%, rgba(255,255,255,.12), transparent 70%);
      transform: rotate(18deg);
      animation: shine 3.4s linear infinite;
      pointer-events:none;
    }
    @keyframes shine{
      0%{transform: translateX(-35%) rotate(18deg)}
      100%{transform: translateX(35%) rotate(18deg)}
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding-top:6px;
      border-top:1px solid var(--border);
    }
    .left, .right{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    button{
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
    }
    button:hover{border-color: rgba(78,161,255,.55)}
    button:disabled{opacity:.5; cursor:not-allowed}
    .primary{
      background: linear-gradient(180deg, rgba(78,161,255,.35), rgba(78,161,255,.18));
      border-color: rgba(78,161,255,.55);
    }
    .danger{
      border-color: rgba(255,92,122,.55);
      background: linear-gradient(180deg, rgba(255,92,122,.25), rgba(0,0,0,.16));
    }

    .msg{
      margin-top:12px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px dashed rgba(255,255,255,.18);
      color:var(--muted);
      font-size:12px;
      min-height:42px;
      display:flex;
      align-items:center;
    }
    .msg.good{border-color: rgba(61,220,151,.55); color: rgba(61,220,151,.95)}
    .msg.bad{border-color: rgba(255,92,122,.55); color: rgba(255,92,122,.95)}
    .msg.neutral{color:var(--muted)}

    .side{
      background: rgba(0,0,0,.14);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .side h2{
      font-size:13px; margin:0; color:var(--text);
    }
    .table{
      width:100%;
      border-collapse: collapse;
      font-size:12px;
      color:var(--muted);
    }
    .table td, .table th{
      border-bottom:1px solid rgba(255,255,255,.08);
      padding:8px 6px;
      text-align:left;
    }
    .table th{color:var(--text); font-weight:700}
    .kpi{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .card{
      background: rgba(0,0,0,.18);
      border:1px solid var(--border);
      border-radius: 14px;
      padding:10px 12px;
    }
    .card .label{font-size:11px; color:var(--muted)}
    .card .value{font-size:16px; font-weight:800; margin-top:4px}
    .footer{
      padding:10px 16px 16px;
      color: rgba(159,178,214,.9);
      font-size:11px;
      border-top:1px solid var(--border);
      background: rgba(0,0,0,.10);
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .small{font-size:11px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Slot hra (3 v√°lce, 1 v√Ωhern√≠ ≈ôada)</h1>
        <div class="sub">Symboly jsou emoji, n√°hodnost p≈ôes <code>crypto.getRandomValues</code>, stav se ukl√°d√° do <code>localStorage</code>.</div>
      </div>
      <div class="stats">
        <div class="pill">Z≈Østatek: <b id="balance">0</b></div>
        <div class="pill">S√°zka: <b id="bet">0</b></div>
        <div class="pill">V√Ωhry celkem: <b id="wonTotal">0</b></div>
      </div>
    </header>

    <main>
      <section class="machine">
        <div class="reels">
          <div class="reel"><div class="shine"></div><div class="symbol" id="r1">‚ùì</div></div>
          <div class="reel"><div class="shine"></div><div class="symbol" id="r2">‚ùì</div></div>
          <div class="reel"><div class="shine"></div><div class="symbol" id="r3">‚ùì</div></div>
        </div>

        <div class="controls">
          <div class="left">
            <button id="betDown">‚àí S√°zka</button>
            <button id="betUp">+ S√°zka</button>
            <button id="reset" class="danger">Reset</button>
          </div>
          <div class="right">
            <button id="spin" class="primary">SPIN</button>
          </div>
        </div>

        <div id="message" class="msg neutral">Nastav s√°zku a stiskni SPIN.</div>
      </section>

      <aside class="side">
        <div class="kpi">
          <div class="card">
            <div class="label">Posledn√≠ v√Ωsledek</div>
            <div class="value" id="lastResult">‚Äî</div>
          </div>
          <div class="card">
            <div class="label">Posledn√≠ v√Ωhra</div>
            <div class="value" id="lastWin">0</div>
          </div>
        </div>

        <div>
          <h2>V√Ωplatn√≠ tabulka (n√°sobek s√°zky)</h2>
          <table class="table">
            <thead>
              <tr><th>Kombinace</th><th>V√Ωplata</th></tr>
            </thead>
            <tbody id="paytable"></tbody>
          </table>
          <div class="small">3 stejn√© = v√Ωhra podle symbolu. 2 stejn√© (zleva) = men≈°√≠ v√Ωhra.</div>
        </div>

        <div>
          <h2>Tip</h2>
          <div class="small">
            Pro sd√≠len√≠ nahraj tento soubor na web (nap≈ô. GitHub Pages / vlastn√≠ hosting) a po≈°li URL.
          </div>
        </div>
      </aside>
    </main>

    <div class="footer">
      Lok√°ln√≠ hra bez re√°ln√Ωch penƒõz. Stav (z≈Østatek, statistiky) se ukl√°d√° do prohl√≠≈æeƒçe.
    </div>
  </div>

  <script>
    // --- Konfigurace symbol≈Ø a v√Ωplat ---
    const SYMBOLS = [
      { key:"üçí", w: 26, pay3: 6,  pay2: 2 },
      { key:"üçã", w: 24, pay3: 5,  pay2: 2 },
      { key:"üçá", w: 20, pay3: 7,  pay2: 2 },
      { key:"üîî", w: 18, pay3: 10, pay2: 3 },
      { key:"üíé", w: 12, pay3: 20, pay2: 5 },
    ];
    // w = v√°ha (pravdƒõpodobnost). Vy≈°≈°√≠ = ƒçastƒõj≈°√≠.

    const STORAGE_KEY = "slot_v1_state";

    const el = (id) => document.getElementById(id);

    const ui = {
      r1: el("r1"), r2: el("r2"), r3: el("r3"),
      balance: el("balance"),
      bet: el("bet"),
      wonTotal: el("wonTotal"),
      spin: el("spin"),
      betUp: el("betUp"),
      betDown: el("betDown"),
      reset: el("reset"),
      message: el("message"),
      lastResult: el("lastResult"),
      lastWin: el("lastWin"),
      paytable: el("paytable"),
    };

    const defaultState = {
      balance: 500,
      bet: 10,
      wonTotal: 0,
      lastResult: "‚Äî",
      lastWin: 0,
    };

    let state = loadState();
    let spinning = false;

    renderPaytable();
    syncUI();

    ui.betUp.addEventListener("click", () => {
      if (spinning) return;
      state.bet = clamp(state.bet + 10, 10, 200);
      saveAndSync("S√°zka nastavena.");
    });

    ui.betDown.addEventListener("click", () => {
      if (spinning) return;
      state.bet = clamp(state.bet - 10, 10, 200);
      saveAndSync("S√°zka nastavena.");
    });

    ui.reset.addEventListener("click", () => {
      if (spinning) return;
      state = structuredClone(defaultState);
      saveAndSync("Reset hotov√Ω.");
      setMsg("Nastav s√°zku a stiskni SPIN.", "neutral");
      ui.r1.textContent = "‚ùì"; ui.r2.textContent = "‚ùì"; ui.r3.textContent = "‚ùì";
    });

    ui.spin.addEventListener("click", async () => {
      if (spinning) return;
      if (state.balance < state.bet) {
        setMsg("Nedostatek kreditu. Sni≈æ s√°zku nebo resetuj.", "bad");
        return;
      }

      spinning = true;
      setControlsEnabled(false);
      setMsg("Toƒç√≠ se‚Ä¶", "neutral");

      state.balance -= state.bet;
      syncUI();

      // vylosuj fin√°ln√≠ symboly (fair RNG)
      const final = [pickWeighted(), pickWeighted(), pickWeighted()];

      // animace: rychl√© ‚Äûtoƒçen√≠‚Äú a postupn√© zastaven√≠
      const reels = [ui.r1, ui.r2, ui.r3];
      const stopDelays = [650, 900, 1150]; // ms

      const start = performance.now();
      const spinTimers = reels.map((reel, idx) => spinReel(reel, final[idx], stopDelays[idx], start));

      await Promise.all(spinTimers);

      // vyhodnocen√≠ v√Ωhry
      const { win, reason } = evaluate(final, state.bet);

      state.lastResult = final.join(" ");
      state.lastWin = win;
      state.wonTotal += win;
      state.balance += win;

      saveState(state);
      syncUI();

      if (win > 0) {
        setMsg(`V√Ωhra: ${win} (${reason})`, "good");
      } else {
        setMsg("Nic. Zkus znovu.", "bad");
      }

      spinning = false;
      setControlsEnabled(true);
    });

    function evaluate(result, bet){
      const [a,b,c] = result;
      // 3 stejn√©
      if (a === b && b === c) {
        const sym = SYMBOLS.find(s => s.key === a);
        const win = bet * sym.pay3;
        return { win, reason: `3√ó ${a} (x${sym.pay3})` };
      }
      // 2 stejn√© zleva
      if (a === b) {
        const sym = SYMBOLS.find(s => s.key === a);
        const win = bet * sym.pay2;
        return { win, reason: `2√ó ${a} zleva (x${sym.pay2})` };
      }
      return { win: 0, reason: "bez kombinace" };
    }

    function spinReel(reelEl, finalSymbol, stopAfterMs, startTime){
      return new Promise(resolve => {
        const tickEvery = 50;
        const timer = setInterval(() => {
          reelEl.textContent = randomSymbolFast();
          const elapsed = performance.now() - startTime;
          if (elapsed >= stopAfterMs) {
            clearInterval(timer);
            reelEl.textContent = finalSymbol;
            resolve();
          }
        }, tickEvery);
      });
    }

    function randomSymbolFast(){
      // rychl√Ω ‚Äûvizu√°ln√≠‚Äú random (ne rozhoduj√≠c√≠ pro v√Ωsledek)
      const idx = Math.floor(Math.random() * SYMBOLS.length);
      return SYMBOLS[idx].key;
    }

    function pickWeighted(){
      // fair RNG: crypto.getRandomValues -> uniform 0..1 -> v√°≈æen√Ω v√Ωbƒõr
      const u = cryptoUnit();
      const total = SYMBOLS.reduce((s,x) => s + x.w, 0);
      let r = u * total;
      for (const sym of SYMBOLS) {
        r -= sym.w;
        if (r <= 0) return sym.key;
      }
      return SYMBOLS[SYMBOLS.length - 1].key;
    }

    function cryptoUnit(){
      const buf = new Uint32Array(1);
      crypto.getRandomValues(buf);
      // 0..(2^32-1) -> 0..1
      return buf[0] / 0xFFFFFFFF;
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function setControlsEnabled(enabled){
      ui.spin.disabled = !enabled;
      ui.betUp.disabled = !enabled;
      ui.betDown.disabled = !enabled;
      ui.reset.disabled = !enabled;
    }

    function setMsg(text, type){
      ui.message.textContent = text;
      ui.message.className = "msg " + type;
    }

    function syncUI(){
      ui.balance.textContent = state.balance;
      ui.bet.textContent = state.bet;
      ui.wonTotal.textContent = state.wonTotal;
      ui.lastResult.textContent = state.lastResult;
      ui.lastWin.textContent = state.lastWin;
    }

    function saveAndSync(msg){
      saveState(state);
      syncUI();
      setMsg(msg, "neutral");
    }

    function saveState(s){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return structuredClone(defaultState);
        const parsed = JSON.parse(raw);
        return { ...structuredClone(defaultState), ...parsed };
      }catch{
        return structuredClone(defaultState);
      }
    }

    function renderPaytable(){
      ui.paytable.innerHTML = "";
      for (const s of SYMBOLS){
        const tr = document.createElement("tr");
        const left = document.createElement("td");
        const right = document.createElement("td");
        left.textContent = `3√ó ${s.key} / 2√ó ${s.key} zleva`;
        right.textContent = `x${s.pay3} / x${s.pay2}`;
        tr.appendChild(left);
        tr.appendChild(right);
        ui.paytable.appendChild(tr);
      }
    }
  </script>
</body>
</html>

